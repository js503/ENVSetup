# Developer zsh profile shortcuts for tmux workflows.

# Location of the interactive tmux menu helper installed by env_setup.sh.
export ENV_SETUP_TMUX_MENU="${ENV_SETUP_TMUX_MENU:-$HOME/.local/bin/tmux_menu.sh}"

# Aliases
## Tmux
alias tv='envsetup_tmux_tv'
alias tls='envsetup_tmux_tls'
alias tko='envsetup_tmux_tko'
alias tveh='envsetup_tmux_tveh'
alias thelp='envsetup_tmux_thelp'

# Helper Functions: Tmux
envsetup_tmux_tv() {
  local session_name=${1:-default}

  if ! command -v tmux >/dev/null 2>&1; then
    echo "tmux is not available on PATH." >&2
    return 1
  fi

  if tmux has-session -t "$session_name" 2>/dev/null; then
    tmux attach-session -t "$session_name"
  else
    tmux new-session -s "$session_name"
  fi
}

envsetup_tmux_tls() {
  if ! command -v tmux >/dev/null 2>&1; then
    echo "tmux is not available on PATH." >&2
    return 1
  fi

  local sessions=()
  while IFS= read -r session; do
    [[ -n $session ]] && sessions+=("$session")
  done < <(tmux list-sessions -F '#S' 2>/dev/null || true)

  if [[ ${#sessions[@]} -eq 0 ]]; then
    echo "No tmux sessions found." >&2
    return 0
  fi

  echo "Available tmux sessions:" >&2
  local index=1
  for session in "${sessions[@]}"; do
    printf "  [%d] %s\n" "$index" "$session" >&2
    index=$((index + 1))
  done
  echo "  [0] Cancel" >&2

  local choice
  while true; do
    read -r "choice?Select session #: "
    [[ -z $choice ]] && continue
    if [[ $choice =~ ^[0-9]+$ && $choice -le ${#sessions[@]} ]]; then
      break
    fi
    echo "Invalid selection." >&2
  done

  if [[ $choice -eq 0 ]]; then
    echo "Cancelled." >&2
    return 0
  fi

  local target_session=${sessions[$((choice - 1))]}
  tmux attach-session -t "$target_session"
}

envsetup_tmux_tko() {
  if ! command -v tmux >/dev/null 2>&1; then
    echo "tmux is not available on PATH." >&2
    return 1
  fi

  if tmux list-sessions >/dev/null 2>&1; then
    tmux kill-server
    echo "All tmux sessions terminated."
  else
    echo "No tmux sessions found."
  fi
}

envsetup_tmux_tveh() {
  if [[ -z ${TMUX:-} ]]; then
    echo "tveh must be run inside a tmux session." >&2
    return 1
  fi

  tmux select-layout even-horizontal
}

# Display tmux help summary.
envsetup_tmux_thelp() {
  cat <<'TMUX_HELP'
Tmux Quick Reference
--------------------
Prefix (Ctrl-b) + c    Create new window
Prefix + ,             Rename window
Prefix + %             Split pane vertically
Prefix + "             Split pane horizontally
Prefix + arrow keys    Navigate panes
Prefix + [             Enter copy mode
Prefix + d             Detach session
TMUX_HELP
}
